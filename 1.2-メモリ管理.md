メモリ管理の考え方と ARC 
[MemoryMgmt](https://developer.apple.com/jp/devcenter/ios/library/documentation/MemoryMgmt.pdf)
# 参照カウント
![reference count](https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/MemoryMgmt/Art/memory_management.jpg)

[Source: Advanced Memory Management Programming Guide](https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html)

Objective-C ではインスタンスへの参照回数が 1 以上であればメモリ領域が確保され続けインスタンスは生存し続けます。

# ARC
ARC では上記の retain, release はコンパイラが自動で補完してくれます。よって、書くとエラーが出てビルド出来ません。

![ARC](http://developer.apple.com/library/mac/releasenotes/MacOSX/WhatsNewInOSX/Art/ARC_design_final.gif)

[Source: Programming With ARC Release Notes](http://developer.apple.com/library/mac/#releasenotes/MacOSX/WhatsNewInOSX/Articles/MacOSX10_7.html)

# オーナーシップ
参照には **強参照** と **弱参照** があります。

## 強参照

参照先のオブジェクトのオーナーシップを持つ。自分がそのオブジェクトの参照を無くすまで確実に参照することができる。デフォルトこの設定

## 弱参照

参照先のオブジェクトのオーナーシップを持たない。そのオブジェクトが破棄されたら参照できなくなる。delegate や blocks 使うときに主に使用

# 循環参照

二つのオブジェクト間で相互に強参照を持つと循環参照が起き、解放されないオブジェクトがうまれる。

「イメージ」

この場合、片方の参照を弱参照にして回避します。

「イメージ」

# 循環参照の例

```objective-c
{
    // MixiParentObject インスタンスへの強参照を parentObj が所持
    MixiParentObject *parentObj = [[MixiParentObject alloc] init];

    // MixiChildObject インスタンスへの強参照を childObj が所持
    MixiChildObject *childObj = [[MixiChildObject alloc] init];

    // MixiParentObject インスタンスのインスタンス変数が childObj への強参照を保持
    parentObj.obj = childObj;
    // MixiChildObject インスタンスのインスタンス変数が parentObj への強参照を保持
    childObj.obj = parentObj;

    //parentObj のスコープを超えるので、parentObj が MixiParentObject インスタンスへの参照を解除（解放）
    //childObj のスコープを超えるので、childObj が MixiChildObject インスタンスを解放

    // parentObj.obj が MixiChildObject インスタンスの強参照を保持
    // childObj.obj が MixiParentObject インスタンスの強参照を保持
}

```